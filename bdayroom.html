<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3D Living Room with Table and Cake</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #000;
    }
    canvas {
      display: block;
    }
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: sans-serif;
      font-size: 24px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="loading">Loading models...</div>

  <script type="module">
    import * as THREE from "https://esm.sh/three@0.160.0";
    import { OrbitControls } from "https://esm.sh/three@0.160.0/examples/jsm/controls/OrbitControls.js";
    import { OBJLoader } from "https://esm.sh/three@0.160.0/examples/jsm/loaders/OBJLoader.js";
    import { MTLLoader } from "https://esm.sh/three@0.160.0/examples/jsm/loaders/MTLLoader.js";

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(2, 2, 5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 5);
    scene.add(dirLight);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    // Grid helper (optional)
    const grid = new THREE.GridHelper(10, 10);
    grid.material.opacity = 0.2;
    grid.material.transparent = true;
    scene.add(grid);

    const loadingText = document.getElementById("loading");
    const loader = new OBJLoader();

    // --- Load Living Room ---
    const mtlLoader = new MTLLoader();
    mtlLoader.setPath("./livingroom/");
    mtlLoader.load("InteriorTest.mtl", (materials) => {
      materials.preload();
      loader.setMaterials(materials);
      loader.setPath("./livingroom/");
      loader.load("InteriorTest.obj",
        (room) => {
          room.scale.set(0.5, 0.5, 0.5);
          room.position.set(0, 0, 0);
          scene.add(room);

          // --- Load Table ---
          loader.setPath("./object/");
          loader.load("Table.obj",
            (table) => {
              table.traverse((child) => {
                if (child.isMesh) {
                  child.material = new THREE.MeshStandardMaterial({
                    color: 0xaaaaaa,
                    metalness: 0.3,
                    roughness: 0.7,
                  });
                }
              });
              table.scale.set(0.3, 0.3, 0.3);
              table.position.set(-0.5, 0, -0.5);
              scene.add(table);

              // --- Load Cake on top of table ---
              loader.load("Cake.obj",
                (cake) => {
                  cake.traverse((child) => {
                    if (child.isMesh) {
                      child.material = new THREE.MeshStandardMaterial({
                        color: 0xffc0cb,
                        metalness: 0.2,
                        roughness: 0.7,
                      });
                    }
                  });

                  // Scale and rotate cake
                  cake.scale.set(0.02, 0.02, 0.02);
                  cake.rotation.x = -Math.PI / 2; // 90 degrees
                  cake.position.set(-0.5, 0.38, -0.5); // adjust Y to sit on table
                  scene.add(cake);

                  loadingText.remove();
                },
                (xhr) => {
                  const percent = (xhr.loaded / xhr.total) * 100;
                  loadingText.textContent = `Loading cake... ${percent.toFixed(0)}%`;
                },
                (error) => {
                  console.error("Error loading cake OBJ:", error);
                  loadingText.textContent = "Error loading cake ðŸ˜¢";
                }
              );
            },
            (xhr) => {
              const percent = (xhr.loaded / xhr.total) * 100;
              loadingText.textContent = `Loading table... ${percent.toFixed(0)}%`;
            },
            (error) => {
              console.error("Error loading table OBJ:", error);
              loadingText.textContent = "Error loading table ðŸ˜¢";
            }
          );
        },
        (xhr) => {
          const percent = (xhr.loaded / xhr.total) * 100;
          loadingText.textContent = `Loading room... ${percent.toFixed(0)}%`;
        },
        (error) => {
          console.error("Error loading room OBJ:", error);
          loadingText.textContent = "Error loading room ðŸ˜¢";
        }
      );
    });

    // --- Resize ---
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // --- Animate ---
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
